# BetaMonitor
This GEANT4 simulation is designed to populate a vacuum cell with decay products from an input source, and measure the energy deposited within a detector located near the cell's window. The goal is to measure the rate of detection from the source intensity.
## Set up
To run this simulation create a ```build/``` directory and ```cmake``` pointing toward the BetaMonitor directory. Following this utilize the ```make``` command within the build directory whenever changes are made to the files in the ```include/``` and ```src/``` directories. There will then be an executable created named BetaMon within the build directory. 

For viewing and small number simulations run the executable and navigate the GEANT4 GUI. Macros can be used to run simulations with larger statistics by adding them to the end of the executable in the command line:

```./BetaMon run1.mac```

# Output files
Output files are defined within ```src/BM_Output.cc```. The file paths defined originate from the build directory. 

## Multicore processing
~~The code was written to compute on 16 threads, to add additional threads, follow the pattern of the current outputs within `src/BM_Output.cc` and `include/BM_Output.hh`, as well as the case statements in `src/BM_EventAction.cc`.~~

~~To alter the number of threads used, one can alter the statement within ```BetaMon.cc```:~~
~~```runManager->SetNumberOfThreads((G4Threading::G4GetNumberOfCores())-2);```~~
~~Regardless of the number of cores selected. All output files will be generated, those of higher value than the number of cores used will be empty.~~

Update Nov 2025 (Clint):  Multithreading support was dropped to simplify the code; this task is ``embarassingly parallel.''  To run with a large number of primaries, simply run multiple single-core processes.

## Merging files
Included in the ```BetaMonitorAnalysis.ipynb``` is the ```load2root``` function which utilizes the uproot library to load in the series of files associated with one simulation and condenses them, after making the cut that the main detector (archaically called SQ) must have some energy deposited by the event. The new root file will contain all events that deposit energy in the detector in the ```[Tree]``` branch, and the total number of simulated events in the ```[Size]``` branch. These can be read in individually via uproot. After condensing these files, one can delete the original separated files to free up disk space.

# Changing Sources
To alter the source, one can change the input file in ```src/FileReader.cc```. There are several sources already included, and more can be added by creating a text document of the probability density function of the given decay. These files set the probability of a given energy being generated for ```heParticleGun``` which is found within ```src/BM_PrimaryGenerator.cc```. Also in ```src/BM_PrimaryGenerator.cc``` is the Monte Carlo for Bi207 that can be generated by invoking the ```fParticleGun->GeneratePrimaryVertex(anEvent);``` found at the end of the file. 

The particle type can be changed at the bottom of ```src/BM_PrimaryGenerator.cc``` by changing the definition of ```G4ParticleDefinition* particle```

Source geometry is defined at the bottom of ```src/BM_PrimaryGenerator.cc``` and is built with respect to the world origin.

# Detector & Decay Volume Geometry
All physical objects are defined within ```src/BM_Detector.cc```. Adding new detectors will require the creation of a new ```logicDetector``` within ```include/BM_Detector.hh```. The detector will then be assigned to a sensitive detector. To properly associate the events with the detector, adjust the HitsCollection within ```include/BM_EventAction.hh```, and ```src/BM_EventAction.cc```. If a new designation is required beyond the provided ```trigger, square, window, vac```, a new case statement will need to be added to ```src/BM_EventAction.cc```.